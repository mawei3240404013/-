工程文件结构

image_rename_tool/
├── app.py               # Flask主应用
├── static/              # 静态文件
│   └── css/
│       └── style.css    # 样式表
├── templates/           # HTML模板
│   └── index.html       # 主页面
└── picture.py           # 原重命名逻辑(稍作修改)

picture.py文件代码
import os
import re

class ImageRenameTool:
    def __init__(self):
        # 支持的图片格式
        self.image_extensions = ('.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.tiff')
        self.status = "就绪"

    def get_image_files(self, folder):
        """获取文件夹中的图片文件"""
        if not folder or not os.path.isdir(folder):
            return [], "请选择有效的文件夹"

        try:
            files = os.listdir(folder)
            image_files = [f for f in files if f.lower().endswith(self.image_extensions)]
            image_files.sort()
            return image_files, "成功获取图片文件"
        except Exception as e:
            return [], f"无法读取文件夹: {str(e)}"

    def generate_preview(self, folder, prefix, start_num, num_digits):
        """生成重命名预览"""
        # 验证输入
        try:
            start_num = int(start_num)
            num_digits = int(num_digits)
            if start_num < 1:
                return [], "起始序号必须大于等于1"
            if num_digits < 1 or num_digits > 6:
                return [], "序号位数必须在1-6之间"
        except ValueError:
            return [], "请输入有效的数字"

        prefix = prefix.strip()
        if not prefix:
            return [], "前缀名称不能为空"

        # 获取图片文件
        image_files, msg = self.get_image_files(folder)
        if not image_files:
            return [], msg

        # 生成预览
        preview = []
        display_files = image_files[:10]
        for i, filename in enumerate(display_files, start=start_num):
            _, ext = os.path.splitext(filename)
            new_filename = f"{prefix}_{i:0{num_digits}d}{ext}"
            preview.append(f"{filename} -> {new_filename}")

        if len(image_files) > 10:
            preview.append(f"... 还有 {len(image_files) - 10} 个文件...")

        return preview, f"已预览 {len(display_files)} 个文件 (共 {len(image_files)} 个)"

    def execute_rename(self, folder, prefix, start_num, num_digits):
        """执行重命名操作"""
        # 验证输入
        try:
            start_num = int(start_num)
            num_digits = int(num_digits)
            if start_num < 1:
                return False, "起始序号必须大于等于1"
            if num_digits < 1 or num_digits > 6:
                return False, "序号位数必须在1-6之间"
        except ValueError:
            return False, "请输入有效的数字"

        prefix = prefix.strip()
        if not prefix:
            return False, "前缀名称不能为空"

        # 获取图片文件
        image_files, msg = self.get_image_files(folder)
        if not image_files:
            return False, msg

        # 执行重命名
        success_count = 0
        skip_count = 0
        error_count = 0
        error_details = []

        for i, filename in enumerate(image_files, start=start_num):
            _, ext = os.path.splitext(filename)
            new_filename = f"{prefix}_{i:0{num_digits}d}{ext}"
            old_path = os.path.join(folder, filename)
            new_path = os.path.join(folder, new_filename)

            if os.path.exists(new_path):
                skip_count += 1
                error_details.append(f"跳过: {filename} (目标文件 {new_filename} 已存在)")
                continue

            try:
                os.rename(old_path, new_path)
                success_count += 1
            except Exception as e:
                error_count += 1
                error_details.append(f"错误: {filename} - {str(e)}")

        result_msg = (f"操作完成!\n"
                      f"成功: {success_count} 个\n"
                      f"跳过: {skip_count} 个\n"
                      f"失败: {error_count} 个")

        if error_details:
            result_msg += "\n\n详细信息:\n" + "\n".join(error_details[:5])
            if len(error_details) > 5:
                result_msg += f"\n... 还有 {len(error_details) - 5} 条信息"

        return True, result_msg

 app.py文件代码
from flask import Flask, render_template, request, jsonify
from picture import ImageRenameTool
import os
import warnings
warnings.filterwarnings("ignore", category=UserWarning)  # 屏蔽Tkinter相关警告


app = Flask(__name__)
rename_tool = ImageRenameTool()

# 基础路径（默认为用户主目录）
BASE_PATH = os.path.expanduser("~")


@app.route('/')
def index():
    return render_template('index.html')


@app.route('/browse', methods=['POST'])
def browse_folder():
    """获取指定路径下的子文件夹列表"""
    data = request.json
    current_path = data.get('path', BASE_PATH)

    # 验证路径有效性
    if not os.path.isdir(current_path):
        current_path = BASE_PATH

    try:
        # 获取所有子文件夹
        items = os.listdir(current_path)
        folders = []
        for item in items:
            item_path = os.path.join(current_path, item)
            if os.path.isdir(item_path):
                folders.append({
                    'name': item,
                    'path': item_path
                })

        # 按名称排序
        folders.sort(key=lambda x: x['name'].lower())

        # 添加上级目录（如果不是根目录）
        parent_path = os.path.dirname(current_path)
        if parent_path != current_path:  # 不是根目录
            folders.insert(0, {
                'name': '.. (上级目录)',
                'path': parent_path
            })

        return jsonify({
            'status': 'success',
            'current_path': current_path,
            'folders': folders
        })
    except Exception as e:
        return jsonify({
            'status': 'error',
            'message': f'无法访问文件夹: {str(e)}'
        })


@app.route('/preview', methods=['POST'])
def preview_rename():
    """生成重命名预览"""
    data = request.form
    folder = data.get('folder_path')
    prefix = data.get('prefix', 'image')
    start_num = data.get('start_num', '1')
    num_digits = data.get('num_digits', '2')

    # 验证文件夹是否有效
    if not folder or not os.path.isdir(folder):
        return jsonify({
            'status': 'error',
            'message': '请选择有效的文件夹'
        })

    # 调用工具类生成预览
    result = rename_tool.generate_preview(folder, prefix, start_num, num_digits)
    return jsonify(result)


@app.route('/rename', methods=['POST'])
def execute_rename():
    """执行重命名操作"""
    data = request.form
    folder = data.get('folder_path')
    prefix = data.get('prefix', 'image')
    start_num = data.get('start_num', '1')
    num_digits = data.get('num_digits', '2')

    # 验证文件夹是否有效
    if not folder or not os.path.isdir(folder):
        return jsonify({
            'status': 'error',
            'message': '请选择有效的文件夹'
        })

    # 执行重命名
    result = rename_tool.execute_rename(folder, prefix, start_num, num_digits)
    return jsonify(result)


if __name__ == '__main__':
    app.run(debug=True)

 templates/index.html文件代码
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片批量重命名工具</title>
    <style>
        body {
            font-family: "SimHei", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 25px;
        }
        .input-group {
            display: flex;
            margin-bottom: 15px;
        }
        input, select, button {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input {
            flex: 1;
            margin-right: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            padding: 8px 20px;
        }
        button:hover {
            background-color: #45a049;
        }
        .settings {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        .setting-item {
            display: flex;
            align-items: center;
        }
        .setting-item label {
            margin-right: 8px;
            min-width: 80px;
        }
        .preview {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 150px;
            background-color: #f9f9f9;
            overflow-y: auto;
            max-height: 200px;
        }
        .folder-browser {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: white;
        }
        #folderList {
            list-style: none;
            padding: 0;
        }
        #folderList li {
            padding: 5px;
            margin: 2px 0;
            background-color: #f0f0f0;
            cursor: pointer;
            border-radius: 3px;
        }
        #folderList li:hover {
            background-color: #e0e0e0;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #e3f2fd;
            color: #0d47a1;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        #renameBtn {
            background-color: #2196F3;
        }
        #renameBtn:hover {
            background-color: #0b7dda;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>图片批量重命名工具</h1>

        <div class="section">
            <h3>图片文件夹</h3>
            <div class="input-group">
                <input type="text" id="folderPath" placeholder="请选择图片文件夹路径">
                <button id="browseBtn">浏览...</button>
            </div>

            <!-- 文件夹浏览区域 -->
            <div class="folder-browser" id="folderBrowser" style="margin-top:10px; display:none; max-height:200px; overflow-y:auto;">
                <div id="currentPathDisplay" style="margin-bottom:10px; font-weight:bold;"></div>
                <ul id="folderList"></ul>
            </div>
        </div>

        <div class="section">
            <h3>命名设置</h3>
            <div class="settings">
                <div class="setting-item">
                    <label for="prefix">前缀名称:</label>
                    <input type="text" id="prefix" value="image">
                </div>
                <div class="setting-item">
                    <label for="startNum">起始序号:</label>
                    <input type="number" id="startNum" value="1" min="1">
                </div>
                <div class="setting-item">
                    <label for="numDigits">序号位数:</label>
                    <select id="numDigits">
                        <option value="1">1位</option>
                        <option value="2" selected>2位</option>
                        <option value="3">3位</option>
                        <option value="4">4位</option>
                        <option value="5">5位</option>
                        <option value="6">6位</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>预览</h3>
            <div class="preview" id="previewArea">
                请选择文件夹并点击"预览效果"查看重命名示例
            </div>
        </div>

        <div class="buttons">
            <button id="previewBtn">预览效果</button>
            <button id="renameBtn">执行重命名</button>
        </div>

        <div class="status" id="statusArea">
            就绪
        </div>

        <div id="resultArea" style="display:none;"></div>
    </div>

    <script>
        // 文件夹浏览功能
        document.getElementById('browseBtn').addEventListener('click', () => {
            const folderBrowser = document.getElementById('folderBrowser');
            folderBrowser.style.display = folderBrowser.style.display === 'none' ? 'block' : 'none';
            loadFolders(); // 加载初始文件夹
        });

        // 加载文件夹列表
        async function loadFolders(path = '') {
            try {
                const response = await fetch('/browse', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path })
                });

                const result = await response.json();
                if (result.status === 'success') {
                    document.getElementById('currentPathDisplay').textContent = result.current_path;
                    const folderList = document.getElementById('folderList');
                    folderList.innerHTML = '';

                    // 生成文件夹列表
                    result.folders.forEach(folder => {
                        const li = document.createElement('li');
                        li.textContent = folder.name;

                        // 点击文件夹进入该目录或选择该目录
                        li.addEventListener('click', () => {
                            if (folder.name.startsWith('..')) {
                                loadFolders(folder.path); // 进入上级目录
                            } else {
                                // 双击选择文件夹，单击进入子目录
                                li.addEventListener('dblclick', () => {
                                    document.getElementById('folderPath').value = folder.path;
                                    document.getElementById('folderBrowser').style.display = 'none';
                                    updateStatus(`已选择文件夹: ${folder.path}`);
                                });
                                loadFolders(folder.path); // 进入子目录
                            }
                        });

                        folderList.appendChild(li);
                    });
                } else {
                    updateStatus(result.message, 'error');
                }
            } catch (error) {
                updateStatus('文件夹浏览失败: ' + error.message, 'error');
            }
        }

        // 预览功能
        document.getElementById('previewBtn').addEventListener('click', async () => {
            const folderPath = document.getElementById('folderPath').value;
            const prefix = document.getElementById('prefix').value;
            const startNum = document.getElementById('startNum').value;
            const numDigits = document.getElementById('numDigits').value;

            if (!folderPath) {
                updateStatus('请选择图片文件夹', 'error');
                return;
            }

            try {
                updateStatus('正在生成预览...');
                const formData = new FormData();
                formData.append('folder_path', folderPath);
                formData.append('prefix', prefix);
                formData.append('start_num', startNum);
                formData.append('num_digits', numDigits);

                const response = await fetch('/preview', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const previewArea = document.getElementById('previewArea');

                if (result.status === 'success') {
                    previewArea.innerHTML = '';
                    result.preview.forEach(item => {
                        const div = document.createElement('div');
                        div.textContent = item;
                        previewArea.appendChild(div);
                    });

                    if (result.has_more) {
                        const moreDiv = document.createElement('div');
                        moreDiv.style.color = '#666';
                        moreDiv.textContent = `... 还有 ${result.remaining} 个文件...`;
                        previewArea.appendChild(moreDiv);
                    }

                    updateStatus(`已预览 ${result.displayed} 个文件 (共 ${result.total} 个)`);
                } else {
                    previewArea.innerHTML = result.message;
                    updateStatus(result.message, 'error');
                }
            } catch (error) {
                updateStatus('预览失败: ' + error.message, 'error');
            }
        });

        // 执行重命名
        document.getElementById('renameBtn').addEventListener('click', async () => {
            const folderPath = document.getElementById('folderPath').value;
            const prefix = document.getElementById('prefix').value;
            const startNum = document.getElementById('startNum').value;
            const numDigits = document.getElementById('numDigits').value;

            if (!folderPath) {
                updateStatus('请选择图片文件夹', 'error');
                return;
            }

            if (!confirm('确定要执行重命名操作吗？此操作不可撤销！')) {
                return;
            }

            try {
                updateStatus('正在执行重命名...');
                const formData = new FormData();
                formData.append('folder_path', folderPath);
                formData.append('prefix', prefix);
                formData.append('start_num', startNum);
                formData.append('num_digits', numDigits);

                const response = await fetch('/rename', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                const resultArea = document.getElementById('resultArea');

                if (result.status === 'success') {
                    resultArea.className = 'result success';
                    resultArea.innerHTML = `
                        <strong>操作完成!</strong><br>
                        成功: ${result.success} 个<br>
                        跳过: ${result.skipped} 个<br>
                        失败: ${result.errors} 个<br>
                    `;

                    if (result.details && result.details.length > 0) {
                        resultArea.innerHTML += '<br><strong>详细信息:</strong><br>';
                        const detailsToShow = result.details.slice(0, 5);
                        detailsToShow.forEach(detail => {
                            resultArea.innerHTML += `- ${detail}<br>`;
                        });

                        if (result.details.length > 5) {
                            resultArea.innerHTML += `- 还有 ${result.details.length - 5} 条信息...`;
                        }
                    }

                    updateStatus(`重命名完成: 成功 ${result.success} 个, 跳过 ${result.skipped} 个, 失败 ${result.errors} 个`);
                } else {
                    resultArea.className = 'result error';
                    resultArea.innerHTML = result.message;
                    updateStatus(result.message, 'error');
                }

                resultArea.style.display = 'block';
                // 重新生成预览
                document.getElementById('previewBtn').click();
            } catch (error) {
                updateStatus('重命名失败: ' + error.message, 'error');
            }
        });

        // 更新状态信息
        function updateStatus(message, type = 'info') {
            const statusArea = document.getElementById('statusArea');
            statusArea.textContent = message;

            if (type === 'error') {
                statusArea.style.backgroundColor = '#ffebee';
                statusArea.style.color = '#c62828';
            } else {
                statusArea.style.backgroundColor = '#e3f2fd';
                statusArea.style.color = '#0d47a1';
            }
        }
    </script>
</body>
</html>

static/css/style.css文件代码
body {
    font-family: "SimHei", "Microsoft YaHei", sans-serif;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #f5f5f5;
}

.container {
    background-color: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

h1, h2 {
    color: #333;
}

.section {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.input-group {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

#folderPath {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

button {
    padding: 8px 16px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #45a049;
}

.settings-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 10px;
}

.setting-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

.setting-item input, .setting-item select {
    padding: 6px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.preview-container {
    margin-top: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 10px;
    height: 200px;
    overflow-y: auto;
    background-color: #f9f9f9;
}

#previewText {
    margin: 0;
    white-space: pre-wrap;
}

.button-group {
    display: flex;
    justify-content: space-between;
    margin: 20px 0;
}

#renameBtn {
    background-color: #2196F3;
}

#renameBtn:hover {
    background-color: #0b7dda;
}

.status-bar {
    margin-top: 20px;
    padding: 8px;
    border-top: 1px solid #eee;
    color: #666;
    font-size: 0.9em;
}


